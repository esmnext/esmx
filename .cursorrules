# Cursor 全局编程规则

## 代码规范

### TypeScript 和模块系统
- 始终使用 TypeScript，严格类型检查
- 使用 ESM 模块系统 (import/export)
- 禁止使用 `any` 类型，使用具体类型或泛型
- 使用严格的 TypeScript 配置：
  - `strict: true`
  - `noImplicitAny: true`
  - `noImplicitReturns: true`
  - `noUnusedLocals: true`
  - `noUnusedParameters: true`

### 导入导出规范
- 使用命名导出而非默认导出
- 导入语句按以下顺序排列：
  1. Node.js 内置模块
  2. 第三方库
  3. 项目内部模块
  4. 相对路径导入
- 使用 `import type` 导入仅用于类型的声明

### 代码质量
- 函数和变量使用描述性命名
- 使用 const 声明不变的引用，let 声明可变引用
- 避免使用 var
- 使用箭头函数和解构赋值
- 适当使用泛型提高代码复用性
- **代码注释必须使用英文**，包括单行注释和多行注释
- **开发完成或执行检查时，必须识别并删除无用的日志**，包括 `console.log`、`console.warn` 等调试输出

## 单元测试规范

### 测试框架和工具
- 使用 Vitest 作为测试框架
- 测试文件命名：`*.test.ts` 或 `*.spec.ts`
- 必要时可在文件头部配置测试环境：`@vitest-environment`

### 测试编写原则
- **严格禁止使用 `any` 类型**，包括在测试代码中
- **严格禁止使用 mock 对象**，使用真实对象和依赖
- 每个测试应该独立运行，不依赖其他测试
- 使用描述性的测试名称，清楚表达测试意图
- 遵循 AAA 模式：Arrange（准备）、Act（执行）、Assert（断言）

### 测试结构
```typescript
describe('模块/功能名称', () => {
    // 使用 beforeEach/afterEach 进行测试环境的设置和清理
    beforeEach(() => {
        // 测试前准备
    });

    afterEach(() => {
        // 测试后清理
    });

    describe('具体功能分组', () => {
        it('should 描述期望的行为', () => {
            // Arrange: 准备测试数据和环境
            
            // Act: 执行被测试的代码
            
            // Assert: 验证结果
            expect(actual).toBe(expected);
        });
    });
});
```

### 测试替代方案
- 使用真实的类实例而不是 mock
- 使用内存数据库或文件系统进行集成测试
- 使用 Test Doubles（测试替身）时，创建具体的测试实现类
- 使用依赖注入来替换外部依赖

### 断言规范
- 使用具体的断言方法：`toBe()`, `toEqual()`, `toBeInstanceOf()` 等
- 避免使用通用的 `toBeTruthy()` 或 `toBeFalsy()`，除非确实需要
- 对异步代码使用 `await` 和相应的异步断言

## 错误处理

### 异常处理
- 使用具体的 Error 类型而不是通用 Error
- 提供有意义的错误消息
- 在测试中验证错误处理逻辑

### 类型安全
- 使用类型守卫函数确保运行时类型安全
- 利用 TypeScript 的联合类型和可选链操作符
- 避免类型断言，除非绝对必要

## 性能和最佳实践

### 代码组织
- 单一职责原则：每个函数/类只做一件事
- 优先使用组合而非继承
- 使用接口定义契约
- 合理使用枚举和常量

### 异步编程
- 优先使用 async/await 而不是 Promise.then()
- 正确处理异步错误
- 在测试中正确等待异步操作完成

## 示例代码风格

```typescript
// Good example
import { readFile } from 'node:fs/promises';
import type { Config } from '../types';

interface UserData {
    id: string;
    name: string;
    email: string;
}

export const fetchUserData = async (userId: string): Promise<UserData> => {
    if (!userId) {
        throw new Error('User ID is required');
    }
    
    // Implementation logic with proper return
    const userData: UserData = {
        id: userId,
        name: `User ${userId}`,
        email: `${userId}@example.com`
    };
    
    return userData;
};

// Test example
describe('fetchUserData', () => {
    it('should return user data when valid userId is provided', async () => {
        // Arrange
        const validUserId = 'user-123';
        
        // Act
        const result = await fetchUserData(validUserId);
        
        // Assert
        expect(result).toHaveProperty('id', validUserId);
        expect(result).toHaveProperty('name');
        expect(result).toHaveProperty('email');
    });
});
```

## 核心开发原则

### 五维开发哲学
在执行任何开发活动时，必须始终从以下五个维度进行思考和评估：

1. **专业性 (Professionalism)**
   - 代码结构合理，遵循最佳实践
   - 接口设计清晰，符合业界标准
   - 错误处理完整，边界情况考虑周全
   - 性能优化合理，避免明显性能问题

2. **真实性 (Authenticity)**
   - 功能实现符合实际需求
   - 测试用例覆盖真实场景
   - 数据验证和业务逻辑正确
   - 避免过度工程化和不必要的复杂性

3. **简洁性 (Simplicity)**
   - 代码清晰易读，逻辑简明
   - 避免重复代码，保持 DRY 原则
   - 接口简洁，职责单一
   - 文档和注释简洁明了

4. **必要性 (Necessity)**
   - 每个功能和代码都应有明确的存在价值
   - 避免为了测试覆盖率而编写无意义的测试
   - 不追求不切实际的完美指标
   - 专注于核心功能和关键路径的质量保证

5. **完整性 (Completeness)**
   - 功能实现应该覆盖所有必要的使用场景
   - 错误处理和边界条件应该全面考虑
   - 接口定义应该包含所有必需的参数和返回值
   - 测试用例应该覆盖主要功能路径和异常情况
   - 文档应该完整描述使用方法和注意事项

### 实施优先级和渐进指导

#### 核心优先级（必须立即执行）
- **类型安全**：禁用 `any` 类型，启用严格 TypeScript 配置
- **测试覆盖**：关键业务逻辑必须有测试，遵循 AAA 模式
- **错误处理**：使用具体 Error 类型，提供有意义错误信息
- **代码审查**：每次 PR 都从五个维度评估质量

#### 高优先级（2周内完成）
- **导入规范**：统一导入顺序，使用命名导出
- **异步编程**：统一使用 async/await，正确处理异步错误
- **Git 提交**：遵循 Conventional Commits 规范

#### 中优先级（1个月内优化）
- **代码结构**：重构违反单一职责原则的代码
- **性能优化**：识别和解决明显性能问题
- **文档完善**：补充关键模块的使用文档

#### 低优先级（持续改进）
- **代码风格**：统一箭头函数、解构赋值等风格
- **开发环境**：统一编辑器配置和代码格式化

### 应用指导原则
- **日常开发**：快速过一遍五个维度（专业性、真实性、简洁性、必要性、完整性）
- **技术决策**：优先考虑实际价值和投入产出比
- **质量平衡**：避免盲目追求完美指标，专注核心质量

### 质量检查和反馈要求
- **检查报告格式**：使用表格格式，包含 ✅ PASS / ❌ FAIL / ⚠️ WARNING 标识
- **报告内容**：检查项、结果状态、详细说明、建议改进
- **总体汇总**：在报告开头提供检查结果概览

## Git 提交规范

### 提交信息格式
- **必须使用英文编写提交信息**
- 遵循 Conventional Commits 规范：`<type>(<scope>): <description>`

### 提交类型 (type)
- `feat`: new feature
- `fix`: bug fix
- `docs`: documentation updates
- `style`: code formatting (no functional changes)
- `refactor`: code refactoring
- `test`: add or modify tests
- `chore`: build tools, dependency management, etc.
- `perf`: performance optimization
- `ci`: CI/CD related changes

### 提交信息示例
```
feat(router): add navigation guards support
fix(core): resolve module loading race condition
docs: update installation guide
test(router-vue): add component hierarchy tests
chore: update dependencies to latest versions
```

### 提交要求
- 标题行不超过 50 字符
- 如需详细说明，标题行后空一行再写详细内容
- 使用祈使语气（"add" 而不是 "added"）
- 首字母小写，末尾不加句号

## 规则维护和冲突解决

### 规则更新机制
- **定期评审**：每季度评估规则适用性和有效性
- **团队反馈**：鼓励团队成员提出改进建议
- **版本管理**：重大修改需要版本记录和变更说明
- **渐进迁移**：新规则实施给予合理过渡期

### 冲突解决原则
1. **五维哲学优先**：当规则冲突时，优先考虑五个维度的平衡
2. **实用性第一**：选择对项目实际价值更大的方案
3. **团队协商**：复杂冲突通过团队讨论决定
4. **文档记录**：决策过程和理由需要记录备查

### 例外情况处理
- **遗留代码**：可以渐进式改进，不要求一次性完全合规
- **第三方依赖**：外部库不符合规范时，在接口层做适配
- **紧急修复**：紧急 bug 修复可以临时放宽规则，但需要后续补充

---

遵循以上规则确保代码质量、类型安全和测试可靠性。